# D01_Linux. Операционные системы UNIX/Linux (Базовый)
  ## Part 1. Установка ОС

    * Установить Ubuntu 20.04.3 Server LTS без графического интерфейса

  Выполняем команду для проверки установленной версии:

  `cat /etc/issue`

  ![check_version_Ubuntu](/D01_Linux-0/misc/images/check_version_Ubuntu.png)

  ---

  ## Part 2. Создание пользователя

    * Создать пользователя, отличного от пользователя, который создавался при установке

  Выполняем команду для создания нового пользователя:

  `sudo adduser` username

  Проверяем результат командой:

  `cat /etc/passwd`

  ![check_user](/D01_Linux-0/misc/images/check_user.png)

  ---

  ## Part 3. Настройка сети ОС

    * Задать название машины вида user-1

  Выполняем команду для изменения названия машины:

  `sudo hostname user-1`

  ![add_user](/D01_Linux-0/misc/images/pc_name_change.png)

  Проверяем результат командой:

  `hostname`

  ![check_user](/D01_Linux-0/misc/images/pc_name.png)

    * Установить временную зону, соответствующую вашему текущему местоположению

  Выполняем команду для просмотра доступных временных зон:

  `timedatectl list-timezones`

  Устанавливаем необходимую временную зону командой:

  `sudo timedatectl set-timezone Asia/Novosibirsk`

  Проверяем результат командой:

  `timedatectl`

  ![time_zone](/D01_Linux-0/misc/images/time_zone.png)

    * Вывести названия сетевых интерфейсов с помощью консольной команды
    * В отчёте дать объяснение наличию интерфейса lo

  Выполняем команду для получения информации о сетевом интерфейсе:

  `ip link show`

  ![names_of_network_interfaces](/D01_Linux-0/misc/images/names_of_network_interfaces.png)

  ![lo_interface](/D01_Linux-0/misc/images/lo_interface.png)

    * Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера
    * В отчёте дать расшифровку DHCP
    * Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw).
    * Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8)
    * Перезагрузить виртуальную машину. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте
    * Успешно пропинговать удаленные хосты 1.1.1.1 и ya.ru и вставить в отчёт скрин с выводом команды

  ![dhcp](/D01_Linux-0/misc/images/dhcp.png)

  Выполняем команду для получения внешнего ip-адреса шлюза:

  `ip route`

  ![ip_adres](/D01_Linux-0/misc/images/ip_adres.png)

  Выполняем команду для получения внутреннего ip-адреса шлюза:

  `nslookup localhost`

  ![internal_ip_adress](/D01_Linux-0/misc/images/internal_ip_adress.png)

  Задаём статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns и применяем их

  `sudo nano /etc/netplan/00-installer-config.yaml`

  `sudo netplan apply`

  ![](/D01_Linux-0/misc/images/static_ip.png)

  Перезагружаем виртуальную машину. Убеждаемся, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте

  `sudo reboot`

  `ip a`

  ![](/D01_Linux-0/misc/images/check_ip.png)

  Пингуем удаленные хосты 1.1.1.1 и ya.ru

  ![](/D01_Linux-0/misc/images/ping_1.1.1.1.png)

  ![](/D01_Linux-0/misc/images/ping_ya.ru.png)

  ---

  ## Part 4. Обновление ОС

    * Обновить системные пакеты до последней на момент выполнения задания версии, после обновления системных пакетов, если ввести команду обновления повторно, должно появится сообщение, что обновления отсутствуют. Вставить скриншот с этим сообщением в отчёт

  Выполняем команду для обновления

  `sudo apt-get update` или `sudo apt-get upgrade` или `sudo apt-get dist-upgrade`

  ![](/D01_Linux-0/misc/images/upgrade.png)

  ---

  ## Part 5. Использование команды **sudo**

    * Разрешить пользователю, созданному в Part 2, выполнять команду sudo
    * В отчёте объяснить истинное назначение команды sudo
    * Поменять hostname ОС от имени пользователя, созданного в Part 2 (используя sudo)
    * Вставить скрин с изменённым hostname в отчёт

  Выполняем команду для изменения прав

  `sudo adduser` username `sudo` 

  `sudo` (англ. Substitute User and do, дословно «подменить пользователя и выполнить») — программа для системного администрирования UNIX-систем, позволяющая делегировать те или иные привилегированные ресурсы пользователям с ведением протокола работы. Основная идея — дать пользователям как можно меньше прав, при этом достаточных для решения поставленных задач. Программа поставляется для большинства UNIX и UNIX-подобных операционных систем

  ![](/D01_Linux-0/misc/images/Sudo_logo.png)

  Bыполняем команду для изменения hostname ОС

  `sudo hostnamectl set-hostname` новое_имя

  ![](/D01_Linux-0/misc/images/check_hostname.png)

  ---

  ## Part 6. Установка и настройка службы времени
  
    * Настроить службу автоматической синхронизации времени
    * Вывести время, часового пояса, в котором вы сейчас находитесь
    * Вывод следующей команды timedatectl show должен содержать NTPSynchronized=yes
    * Вставить скрины с корректным временем и выводом команды в отчёт

  Bыполняем команду для автоматической синхронизации времени

  `systemctl enable systemd-timesyncd.service`

  Bыполняем команду `timedatectl show`

  ![](/D01_Linux-0/misc/images/check_time.png)

  ---

  ## Part 7. Установка и использование текстовых редакторов

    * Установить текстовые редакторы VIM (+ любые два по желанию NANO, MCEDIT, JOE и т.д.)  
    * Используя каждый из трех выбранных редакторов, создайте файл test_X.txt, где X -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений
    * В отчёт вставьте скриншоты:
      - Из каждого редактора с содержимым файла перед закрытием
      - В отчёте укажите, что сделали для выхода с сохранением изменений
    * Используя каждый из трех выбранных редакторов, откройте файл на редактирование, отредактируйте файл, заменив никнейм на строку "21 School 21", закройте файл без сохранения изменений
      - В отчёт вставьте скриншоты:
      - Из каждого редактора с содержимым файла после редактирования
      - В отчёте укажите, что сделали для выхода без сохранения изменений
    * Используя каждый из трех выбранных редакторов, отредактируйте файл ещё раз (по аналогии с предыдущим пунктом), а затем освойте функции поиска по содержимому файла (слово) и замены слова на любое другое
      - В отчёт вставьте скриншоты:
      - Из каждого редактора с результатами поиска слова
      - Из каждого редактора с командами, введёнными для замены слова на другое

  Bыполняем команду для установки редакторов

  `sudo apt install vim`

  `sudo apt install nano`

  `sudo apt install mcedit`

  ## Редактор vim

  ![](/D01_Linux-0/misc/images/alvintha_vim.png)

  для выхода с сохранением изменений: `esc` -> `shift` + `:` -> пишем `wq` -> `enter`

  ## Редактор nano

  ![](/D01_Linux-0/misc/images/alvintha_nano.png)

  для выхода с сохранением изменений: `control` + `x` -> `control` + `y` -> `enter`

  ## Редактор mcedit

  ![](/D01_Linux-0/misc/images/alvintha_mcedit.png)

  для выхода с сохранением изменений: `fn` + `F2` -> `save`->`fn` + `F10`

  ## Редактор vim

  ![](/D01_Linux-0/misc/images/change_vim_without_save.png)

  для выхода без сохранения изменений: `esc` -> `shift` + `:` -> пишем `q!` -> `enter`

  ## Редактор nano

  ![](/D01_Linux-0/misc/images/change_nano_without_save.png)

  для выхода без сохранения изменений: `control` + `x` -> `control` + `n` -> `enter`

  ## Редактор mcedit

  ![](/D01_Linux-0/misc/images/change_mcedit_without_save.png)

  для выхода с сохранением изменений: `fn` + `F10`-> `no` -> `enter`

  ## Редактор vim

  ![](/D01_Linux-0/misc/images/vim_poisk.png)

  для поиска символа(фразы): `esc` -> `/` -> `фраза`

  ![](/D01_Linux-0/misc/images/vim_zamena.png)

  для замены символа(фразы): `esc` -> `shift` + `:` -> `s/` -> `фраза которую необходимо заменить` -> `/` -> `фраза на которую меняем`

  ## Редактор nano

  ![](/D01_Linux-0/misc/images/nano_poisk.png)

  для поиска символа(фразы): `control` + `w`

  ![](/D01_Linux-0/misc/images/nano_zamena.png)

  для замены символа(фразы): `control` + `\`

  ## Редактор mcedit

  ![](/D01_Linux-0/misc/images/mcedit_poisk.png)

  для поиска символа(фразы): `fn` + `F7`

  ![](/D01_Linux-0/misc/images/mcedit_zamena.png)

  для замены символа(фразы): `fn` + `F4`

  ---

  ## Part 8. Установка и базовая настройка сервиса SSHD
    * Установить службу SSHd
    * Добавить автостарт службы при загрузке системы
    * Перенастроить службу SSHd на порт 2022
    * Используя команду ps, показать наличие процесса sshd. Для этого к команде нужно подобрать ключи
    * В отчёте объяснить значение команды и каждого ключа в ней
    * Перезагрузить систему
    * Вывод команды netstat -tan должен содержать tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN
    * Скрин с выводом команды вставить в отчёт
    * В отчёте объяснить значение ключей -tan, значение каждого столбца вывода, значение 0.0.0.0.

  Bыполняем команду для установки службы SSHd:

  `sudo apt install openssh-server`

  Bыполняем команду для автостарта службы при загрузке системы:

  `sudo systemctl enable ssh`

  Перенастраиваем службу SSHd на порт 2022 в редакторе:

  `sudo mcedit /etc/ssh/sshd_config`

  Выполняем команду для просмотра процессов:

  `ps -FC sshd`

  `ps` - утилита для просмотра списка процессов в Linux\
  `-C` - выбирает процессы по имени команды\
  `-F` - выводит максимум доступных данных

  ![](/D01_Linux-0/misc/images/ps.png)

   Выполняем команду:
   
   `netstat -tan`

  ![](/D01_Linux-0/misc/images/netstat.png)

  `-t` - отображает текущее подключение в состоянии переноса нагрузки с процессора на сетевой адаптер при передаче данных ( "offload" )

  `-a` - отображает все подключения и ожидающие порты
  
  `-n` - отображает адреса и номера портов как числа

  `Proto` - название протокола(tcp, udp, raw)

  `Recv-Q`- счётчик байт нескопированных программой пользователя из этого сокета

  `Send-Q`- счётчик байтов, не подтверждённых удалённым узлом

  `Local address` - локальный IP-адрес участвующий в соединении или связанный со службой, ожидающей входящие соединения (слушающей порт). Если в качестве адреса отображается 0.0.0.0, то это означает - "любой адрес", т.е в соединении могут использоваться все IP-адреса существующие на данном компьютере. Адрес 127.0.0.1 - это петлевой интерфейс, используемый в качестве средства IP протокола для взаимодействия между процессами без реальной передачи данных

  `Foreing Address` - внешний IP-адрес, участвующий в создании соединения

  `State` - состояние соединения. Состояние LISTEN говорит о том, что строка состояния отображает информацию о сетевой службе, ожидающей входящие соединения по соответствующему протоколу на адрес и порт, отображаемые в колонке "Локальный адрес". Состояние ESTABLISHED указывает на активное соединение

  ---

  ## Part 9. Установка и использование утилит top, htop

    * Установить и запустить утилиты top и htop
    * По выводу команды top определить и написать в отчёте:
      - uptime
      - количество авторизованных пользователей
      - общую загрузку системы
      - общее количество процессов
      - загрузку cpu
      - загрузку памяти
      - pid процесса занимающего больше всего памяти
      - pid процесса, занимающего больше всего процессорного времени
    * В отчёт вставить скрин с выводом команды htop:
      - отсортированному по PID, PERCENT_CPU, PERCENT_MEM, TIME
      - отфильтрованному для процесса sshd
      - с процессом syslog, найденным, используя поиск 
      - с добавленным выводом hostname, clock и uptime

  Выполняем команду `top`

  ![](/D01_Linux-0/misc/images/top.png)

  uptime  - 32 мин\
  количество авторизованных пользователей - 0\
  общая загрузка системы - 0.00(1 мин), 0.01(5 мин), 0.03(15 мин)\
  общее количество процессов - 119\
  загрузку cpu - 0.3\
  загрузку памяти - 981\
  pid процесса занимающего больше всего памяти - 3119\
  pid процесса, занимающего больше всего процессорного времени - 3119

  Выполняем команду `htop`

  сортировка по PID
  ![](/D01_Linux-0/misc/images/htop_pid.png)

  сортировка по PERCENT_CPU
  ![](/D01_Linux-0/misc/images/htop_percent_cpu.png)

  сортировка по PERCENT_MEM
  ![](/D01_Linux-0/misc/images/htop_percent_mem.png)

  сортировка по TIME
  ![](/D01_Linux-0/misc/images/htop_time.png)

  фильтр для процесса sshd
  ![](/D01_Linux-0/misc/images/htop_sshd.png)

  фильтр с процессом syslog
  ![](/D01_Linux-0/misc/images/htop_syslog.png)

  с добавленным выводом hostname, clock и uptime
  ![](/D01_Linux-0/misc/images/htop_dop_settings.png)

  ---

  ## Part 10. Использование утилиты fdisk

    * Запустить команду fdisk -l
    * В отчёте написать название жесткого диска, его размер и количество секторов, а также размер swap

  ![](/D01_Linux-0/misc/images/fdisk.png)

  Название диска - Disk /dev/sda

  размер: 16 GiB 17179869184 bytes

  секторов: 33554432

  размер swap: 1.9G

  ---

  ## Part 11. Использование утилиты **df**

    * Запустить команду df в отчёте написать для корневого раздела (/):
      - размер раздела
      - размер занятого пространства
      - размер свободного пространства
      - процент использования
      - определить и написать в отчёт единицу измерения в выводе
    * Запустить команду df -Th в отчёте написать для корневого раздела (/):
      - размер раздела
      - размер занятого пространства
      - размер свободного пространства
      - процент использования
      - определить и написать в отчёт тип файловой системы для раздела

  Выполняем команды `df` и `df -Th`

  ![](/D01_Linux-0/misc/images/df.png)

   команда `df`  
   - размер раздела: 16445308
   - размер занятого пространства: 5550000
   - размер свободного пространства: 10040220
   - процент использования: 36%  
   - единица измерения в выводе: 1K байт

  команда `df -Th`
  - размер раздела: 16G
  - размер занятого пространства: 5.3G
  - размер свободного пространства: 9.6G
  - процент использования: 36%
  - тип файловой системы для раздела: ext4

  ---

  ## Part 12. Использование утилиты du

    * Вывести размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде)
    * Вывести размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)
    * В отчёт вставить скрины с выводом всех использованных команд

  ![](/D01_Linux-0/misc/images/du.png)

  ![](/D01_Linux-0/misc/images/du_var_log.png)

  ---

  ## Part 13. Установка и использование утилиты ncdu

    * Установить утилиту ncdu
      - Вывести размер папок /home, /var, /var/log
      - В отчёт вставить скрины с выводом использованных команд

  ![](/D01_Linux-0/misc/images/ncdu_home.png)

  ![](/D01_Linux-0/misc/images/ncdu_var.png)

  ![](/D01_Linux-0/misc/images/ncdu_var_log.png)

  ---

  ## Part 14. Работа с системными журналами
  
    * Открыть для просмотра:
      - 1. /var/log/dmesg
      - 2. /var/log/syslog
      - 3. /var/log/auth.log
    * Написать в отчёте время последней успешной авторизации, имя пользователя и метод входа в систему
    * Перезапустить службу SSHd
    * Вставить в отчёт скрин с сообщением о рестарте службы (искать в логах)
  ![](/D01_Linux-0/misc/images/14_log.png)

  Перезапускаем службу SSHd

  `sudo systemctl restart ssh.service`

  ![](/D01_Linux-0/misc/images/14_ssh_restart.png)

  ---

  ## Part 15. Использование планировщика заданий CRON

    * Используя планировщик заданий, запустите команду uptime через каждые 2 минуты
      - Найти в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении
      - Вывести на экран список текущих заданий для CRON
      - Вставить в отчёт скрины со строчками о выполнении и списком текущих задач
    * Удалите все задания из планировщика заданий
      - В отчёт вставьте скрин со списком текущих заданий для CRON

  Запускаем cron

  `crontab -e`

  Запускаем команду uptime через каждые 2 минуты

  `*/2 * * * * uptime > /dev/null 2>&1`

  ![](/D01_Linux-0/misc/images/15_uptime.png)

  Выполняем команду для вывода на экран списка текущих заданий для CRON
  
  `crontab -l`:

  ![](/D01_Linux-0/misc/images/15_cron_l.png)

  Выполняем команду для удаления всех заданий из планировщика CRON
  
  `crontab -r`

  ![](/D01_Linux-0/misc/images/15_cron_r.png)

  ---
